# -*- coding: utf-8 -*-
"""Architectural Diagram Fraudulent transaction.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1svaNjX1KYVFvdibRN8bZ8BXco8IY6LcT
"""

from diagrams import Diagram, Node, Cluster, Edge
from diagrams.custom import Custom
from diagrams.aws.compute import EC2
from diagrams.aws.storage import S3
from diagrams.aws.ml import Sagemaker
from diagrams.aws.security import Cognito
from diagrams.aws.management import Cloudwatch
from diagrams.aws.general import User
from diagrams.aws.engagement import SimpleEmailServiceSesEmail
from diagrams.azure.general import Usericon
from urllib.request import urlretrieve
from PIL import Image


with Diagram("Fraudulent Transaction Predicition Application Architecture", show=False, direction="LR", outformat="png") as diag:
    # S3 Buckets
    with Cluster("S3 Buckets"):
        bucket2 = S3("Bucket 1")
        bucket3 = S3("Bucket 2")

    # Sagemaker
    sagemaker = Sagemaker("Sagemaker")

    # Cognito
    cognito = Cognito("Cognito")

    # SES
    ses = SimpleEmailServiceSesEmail("Email Serivices")

    # Connect components
    bucket2 >> sagemaker
    sagemaker >> bucket3

    # User
    user = Usericon("Users")

    # EC2 Cluster with Streamlit and NGINX
    with Cluster("EC2"):
        streamlit_URL = "https://blog.streamlit.io/content/images/size/w1000/2021/03/logomark-color.png"
        website_icon_path = "streamlit.png"
        urlretrieve(streamlit_URL, website_icon_path)
        img = Image.open(website_icon_path)
        resized_img = img.resize((280, 250))
        resized_img.save(website_icon_path)

        streamlit = Custom("Streamlit",website_icon_path, edge_label=" ", fontsize="12")
        nginx = EC2("NGINX")
        nginx >> streamlit

    # Connect Sagemaker to Streamlit without attempting to add a label directly
    sagemaker >> Edge(label = "Output") >> streamlit
    streamlit >> sagemaker
    bucket3 >> EC2
    nginx >> Edge(label = "Authentication") >> cognito
    cognito >> Edge(label = "ID Token") >> nginx
    sagemaker >> Cloudwatch("CloudWatch")
    streamlit >> ses
    sagemaker >> Cloudwatch
    user >> nginx
    streamlit >> user

diag